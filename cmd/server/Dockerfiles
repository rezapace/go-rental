FROM golang:1.22.4 AS builder
WORKDIR /build

COPY . .
COPY ./.env /build/.env

RUN go mod download 
RUN go build -o ./server ./cmd/server/main.go

FROM gcr.io/distroless/base-debian12
WORKDIR /app

COPY --from=builder /build/server ./server
COPY --from=builder /build/.env /app/.env

CMD ["/app/server"]
